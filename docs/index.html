<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kid Learn Quest: Ultimate Edition</title>
    <style>
        :root { --bg: #f0f4f8; --toddler: #fff176; --explorer: #64b5f6; --genius: #ce93d8; --story: #ffccbc; --gold: #ffd700; --green: #81c784; }
        body { font-family: 'Comic Sans MS', cursive, sans-serif; background: var(--bg); text-align: center; margin: 0; padding: 20px; overflow-x: hidden; transition: 0.5s; }
        
        /* Animations */
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .pop { animation: pop 0.3s ease-out; }
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 999; pointer-events: none; }

        /* Progress Bar */
        .progress-container { width: 90%; max-width: 400px; background: #ddd; border-radius: 20px; margin: 10px auto; height: 20px; border: 2px solid #333; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--green); width: 0%; transition: width 0.5s; }

        /* Player Selection */
        .player-select-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; }
        .player-box { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin: 10px; width: 250px; cursor: pointer; border-bottom: 6px solid #ccc; }
        .player-box:active { transform: translateY(4px); border-bottom-width: 2px; }

        header { background: white; padding: 15px; border-radius: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .section-header { margin: 25px 0 10px; font-size: 1.2rem; color: #666; display: block; text-align: left; padding-left: 10px; border-left: 5px solid #ddd; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 450px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 20px; cursor: pointer; border-bottom: 6px solid #ddd; font-weight: bold; font-size: 1.1rem; }
        .card:active { transform: translateY(4px); border-bottom-width: 2px; }
        
        .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(85px, 1fr)); gap: 12px; padding: 10px; justify-content: center; }
        .item-card { background: white; padding: 20px; border-radius: 15px; font-size: 2.2rem; border-bottom: 4px solid #ccc; cursor: pointer; }
        
        .hidden { display: none !important; }
        .back-btn { background: #333; color: white; border: none; padding: 12px 25px; border-radius: 50px; margin-bottom: 20px; cursor: pointer; font-size: 1rem; }
        
        #certificate { background: #fffde7; border: 10px double var(--gold); padding: 30px; border-radius: 15px; max-width: 450px; margin: auto; }
        .story-box { background: white; padding: 20px; border-radius: 20px; font-size: 1.2rem; line-height: 1.6; max-width: 400px; margin: auto; }
    </style>
</head>
<body>

    <section id="player-select-screen" class="player-select-screen">
        <h1>ğŸŒŸ Who is playing?</h1>
        <div class="player-box" onclick="pickPlayer(1)">ğŸ‘¤ <span id="p1-n">Player 1</span><br>â­ <span id="p1-s">0</span></div>
        <div class="player-box" onclick="pickPlayer(2)">ğŸ‘¤ <span id="p2-n">Player 2</span><br>â­ <span id="p2-s">0</span></div>
        <div class="player-box" onclick="pickPlayer(3)">ğŸ‘¤ <span id="p3-n">Player 3</span><br>â­ <span id="p3-s">0</span></div>
        <p style="font-size: 0.8rem; color: #888;">(Long press name to edit)</p>
    </section>

    <main id="game-interface" class="hidden">
        <header>
            <h2 id="hello-name">Hi!</h2>
            <div class="progress-container"><div id="prog-bar" class="progress-bar"></div></div>
            <div style="font-weight:bold">Stars: <span id="user-stars">0</span> / 100</div>
            <div style="margin-top:10px;">
                <button class="back-btn" style="background:var(--gold); color:black; padding:8px 15px;" onclick="view('shop')">ğŸ›ï¸ Shop</button>
                <button class="back-btn" style="background:#eee; color:black; padding:8px 15px;" onclick="location.reload()">ğŸ”„ Switch</button>
            </div>
        </header>

        <section id="menu-view">
            <span class="section-header">Toddler (2-5)</span>
            <div class="grid">
                <div class="card" style="background:var(--toddler);" onclick="view('abc', 'Let\'s learn letters!')">ğŸ”¤ ABCs</div>
                <div class="card" style="background:var(--toddler);" onclick="view('zoo', 'Hear the animals!')">ğŸ¦ Zoo</div>
            </div>
            <span class="section-header">Explorer (6-9)</span>
            <div class="grid">
                <div class="card" style="background:var(--explorer);" onclick="view('math', 'Math time!')">â• Math</div>
                <div class="card" style="background:var(--story);" onclick="view('read', 'Story time!')">ğŸ“š Story</div>
            </div>
            <span class="section-header">Genius (10-12)</span>
            <div class="grid">
                <div class="card" style="background:var(--genius);" onclick="view('sci', 'Science Lab!')">ğŸ§ª Science</div>
                <div class="card" style="background:var(--explorer);" onclick="view('space', 'To the stars!')">ğŸš€ Space</div>
            </div>
            <div id="prize-notif" class="hidden" style="margin-top:20px;">
                <button class="card pop" style="background:var(--gold); width:90%;" onclick="view('cert')">ğŸ† OPEN YOUR PRIZE! ğŸ†</button>
            </div>
        </section>

        <section id="abc-view" class="hidden"><button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button><div class="game-grid" id="abc-cont"></div></section>
        <section id="zoo-view" class="hidden"><button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button><div class="game-grid" id="zoo-cont"></div></section>
        
        <section id="math-view" class="hidden">
            <button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button>
            <h1 id="mq" style="font-size:3.5rem;"></h1>
            <input type="number" id="ma" style="font-size:2rem; width:120px; border-radius:15px; border:3px solid #ccc; text-align:center;">
            <br><br><button class="back-btn" style="background:var(--green)" onclick="checkM()">Check Answer</button>
        </section>

        <section id="read-view" class="hidden">
            <button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button>
            <div class="story-box">
                <p id="st-text">Loading...</p>
                <button class="back-btn" style="background:var(--explorer)" onclick="readAloud()">ğŸ”Š Read to Me</button>
            </div>
        </section>

        <section id="sci-view" class="hidden"><button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button><div class="game-grid" id="sci-cont"></div></section>
        <section id="space-view" class="hidden"><button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button><div class="game-grid" id="space-cont"></div></section>

        <section id="shop-view" class="hidden">
            <button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button>
            <h2>Star Shop</h2>
            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
                <div class="card" style="width:100px; font-size:0.8rem;" onclick="buy('ğŸ¦–', 5)">ğŸ¦– Dino (5â­)</div>
                <div class="card" style="width:100px; font-size:0.8rem;" onclick="buy('ğŸ¦„', 5)">ğŸ¦„ Pony (5â­)</div>
                <div class="card" style="width:100px; font-size:0.8rem;" onclick="buy('ğŸš€', 5)">ğŸš€ Rocket (5â­)</div>
            </div>
            <h3>My Sticker Collection</h3>
            <div id="stickers-owned" style="font-size:3rem;"></div>
        </section>

        <section id="cert-view" class="hidden">
            <button class="back-btn" onclick="view('menu')">â¬…ï¸ Back</button>
            <div id="certificate">
                <h1 style="color: #b8860b;">OFFICIAL PRIZE</h1>
                <p>Awarded to</p>
                <h2 id="cert-user-name" style="font-size:2.5rem; color:#1e88e5;">NAME</h2>
                <p>For being an amazing</p>
                <h3>SUPER LEARNER</h3>
                <div style="font-size:4rem;">ğŸŒŸğŸ‘‘ğŸŒŸ</div>
                <button class="back-btn" onclick="window.print()">ğŸ–¨ï¸ Print My Prize</button>
            </div>
        </section>
    </main>

    <script>
        let players = JSON.parse(localStorage.getItem('QuestData')) || {
            1: {name: "Player 1", stars: 0, stickers: []},
            2: {name: "Player 2", stars: 0, stickers: []},
            3: {name: "Player 3", stars: 0, stickers: []}
        };
        let activeID = 1;

        function updateLanding() {
            for(let i=1; i<=3; i++) {
                document.getElementById(`p${i}-n`).innerText = players[i].name;
                document.getElementById(`p${i}-s`).innerText = players[i].stars;
            }
        }
        updateLanding();

        function pickPlayer(id) {
            activeID = id;
            document.getElementById('player-select-screen').classList.add('hidden');
            document.getElementById('game-interface').classList.remove('hidden');
            document.getElementById('hello-name').innerText = "Hi, " + players[activeID].name + "!";
            sync();
            speak("Welcome back, " + players[activeID].name);
        }

        function sync() {
            let p = players[activeID];
            document.getElementById('user-stars').innerText = p.stars;
            document.getElementById('prog-bar').style.width = Math.min(p.stars, 100) + "%";
            if(p.stars >= 100) document.getElementById('prize-notif').classList.remove('hidden');
            localStorage.setItem('QuestData', JSON.stringify(players));
        }

        function speak(txt, slow = false) {
            window.speechSynthesis.cancel();
            const m = new SpeechSynthesisUtterance(txt);
            m.rate = slow ? 0.75 : 0.9;
            window.speechSynthesis.speak(m);
        }

        function celebrate() {
            players[activeID].stars++;
            sync();
            for(let i=0; i<20; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
                document.body.appendChild(c);
                c.animate([{transform:'translateY(0)', opacity:1},{transform:'translateY(100vh)', opacity:0}], 2000);
                setTimeout(()=>c.remove(), 2000);
            }
        }

        function view(v, msg) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById(v + '-view').classList.remove('hidden');
            if(msg) speak(msg);
            if(v === 'abc') fill('abc-cont', "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""), 'toddler');
            if(v === 'zoo') fill('zoo-cont', ['ğŸ¶','ğŸ±','ğŸ¦','ğŸ®','ğŸ·','ğŸµ'], 'toddler', true);
            if(v === 'math') nextMath();
            if(v === 'read') { document.getElementById('st-text').innerText = "The Happy Sun: Every morning, the sun wakes up and smiles at the world. It makes the grass green and the flowers grow. Thank you, Mr. Sun!"; }
            if(v === 'sci') fill('sci-cont', ['ğŸ§ª','ğŸ”¬','ğŸ§¬','âš—ï¸','ğŸ”­'], 'genius');
            if(v === 'space') fill('space-cont', ['ğŸŒ','ğŸª','ğŸš€','â˜€ï¸','ğŸŒ™'], 'explorer');
            if(v === 'shop') loadShop();
            if(v === 'cert') document.getElementById('cert-user-name').innerText = players[activeID].name;
        }

        function fill(id, items, age, zoo = false) {
            const cont = document.getElementById(id);
            if(cont.innerHTML !== "") return;
            items.forEach(i => {
                const d = document.createElement('div'); d.className = 'item-card';
                d.style.background = `var(--${age})`; d.innerText = i;
                d.onclick = () => { d.classList.add('pop'); setTimeout(()=>d.classList.remove('pop'), 300); speak(i, age==='toddler'); celebrate(); };
                cont.appendChild(d);
            });
        }

        let ca = 0;
        function nextMath() {
            let n1 = Math.floor(Math.random()*12); let n2 = Math.floor(Math.random()*12);
            ca = n1 + n2; document.getElementById('mq').innerText = `${n1} + ${n2}`;
            document.getElementById('ma').value = "";
        }
        function checkM() {
            if(parseInt(document.getElementById('ma').value) === ca) { speak("Correct!"); celebrate(); nextMath(); }
            else { speak("Try again!"); }
        }

        function readAloud() { speak(document.getElementById('st-text').innerText); celebrate(); }

        function buy(emoji, price) {
            if(players[activeID].stars >= price) {
                players[activeID].stars -= price;
                players[activeID].stickers.push(emoji);
                sync(); loadShop(); speak("Awesome sticker!");
            } else { speak("Collect more stars!"); }
        }

        function loadShop() {
            document.getElementById('stickers-owned').innerText = players[activeID].stickers.join(" ");
        }

        // Edit Name Feature
        document.querySelectorAll('.player-box').forEach((b, i) => {
            b.oncontextmenu = (e) => {
                e.preventDefault();
                let n = prompt("Enter Child's Name:");
                if(n) { players[i+1].name = n; updateLanding(); sync(); }
            };
        });
    </script>
</body>
</html>
