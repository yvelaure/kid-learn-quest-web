<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sovereign Nexus | Identity Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --p-blue: #3b82f6; --p-gold: #fbbf24; --p-green: #22c55e;
            --p-bg: #f8fafc; --p-card: #ffffff; --p-text: #1e293b;
        }
        body.night-mode { 
            --p-bg: #0f172a; --p-card: #1e293b; --p-text: #f1f5f9; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        body { background: var(--p-bg); margin: 0; color: var(--p-text); transition: 0.5s; padding-bottom: 50px; }

        /* LOGIN SCREEN */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: linear-gradient(135deg, var(--p-blue), #6366f1);
            z-index: 9999; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; color: white; padding: 20px;
        }
        .login-input {
            padding: 20px; width: 100%; max-width: 300px; border-radius: 20px;
            border: none; font-size: 1.2rem; text-align: center; margin: 20px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* HEADER */
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: var(--p-card); position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 15px rgba(0,0,0,0.1); }
        .logo { font-weight: 900; font-size: 1.4rem; color: var(--p-blue); cursor: pointer; }
        .star-pill { background: #fffbeb; border: 2px solid #fde68a; padding: 8px 15px; border-radius: 50px; font-weight: 900; color: #92400e; }

        /* DRAGON AREA */
        .dragon-box { background: var(--p-card); margin: 20px; padding: 40px 20px; border-radius: 45px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.05); position: relative; }
        .pet-emoji { font-size: 7rem; cursor: pointer; }
        .pet-acc { position: absolute; top: 35px; left: 50%; transform: translateX(-50%); font-size: 3.5rem; pointer-events: none; }
        .p-bar-bg { background: #e2e8f0; height: 12px; border-radius: 10px; width: 80%; margin: 15px auto; overflow: hidden; }
        .p-bar-fill { background: var(--p-green); height: 100%; width: 0%; transition: 1s; }

        /* NAVIGATION */
        .grade-nav { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .grade-tab { padding: 12px 18px; border-radius: 15px; background: #e2e8f0; color: #64748b; font-weight: 800; border: none; cursor: pointer; font-size: 0.8rem; }
        .grade-tab.active { background: var(--p-blue); color: white; }

        /* WORLD MAP */
        .world-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .island { background: var(--p-card); padding: 25px 10px; border-radius: 35px; text-align: center; cursor: pointer; box-shadow: 0 8px 20px rgba(0,0,0,0.02); }
        .island-icon { font-size: 2.2rem; display: block; margin-bottom: 8px; }
        .island b { font-size: 0.85rem; text-transform: uppercase; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p-bg); z-index: 5000; display: none; flex-direction: column; padding: 30px; text-align: center; overflow-y: auto; }
        .opt-btn { background: var(--p-card); border: 2px solid #e2e8f0; padding: 18px; border-radius: 20px; margin-bottom: 12px; font-size: 1.2rem; font-weight: 800; width: 100%; cursor: pointer; }
        .opt-btn:active { background: var(--p-blue); color: white; }
        .exit-btn { background: #1e293b; color: white; border: none; padding: 18px; border-radius: 20px; font-weight: 900; margin-top: auto; width: 100%; }
    </style>
</head>
<body id="master-body">

    <div id="login-screen">
        <h1 style="font-size: 2.5rem; margin: 0;">SOVEREIGN</h1>
        <p style="font-weight: 600; opacity: 0.9;">Type your name to begin!</p>
        <input type="text" id="user-name-input" class="login-input" placeholder="Hero Name...">
        <button class="opt-btn" style="background: var(--p-gold); border: none; width: auto; padding: 15px 40px;" onclick="startGame()">START ADVENTURE</button>
    </div>

    <header>
        <div class="logo" onclick="openReport()">SOVEREIGN</div>
        <button style="background:#ef4444; color:white; border:none; padding:8px 15px; border-radius:50px; font-weight:900; font-size: 0.7rem;" onclick="addStars(1000)">üéÅ GIFT</button>
        <div class="star-pill">‚≠ê <span id="s-val">250</span></div>
    </header>

    <div class="dragon-box" id="capture-area">
        <div id="acc-box" class="pet-acc"></div>
        <div class="pet-emoji" id="p-img" onclick="dragonTalk()">ü•ö</div>
        <div id="welcome-msg" style="font-weight:900; font-size:1.4rem; margin-top:10px; color: var(--p-blue);">WELCOME!</div>
        <div id="p-name" style="font-weight:700; font-size:1rem; opacity: 0.7; margin-bottom: 10px;">EGG STAGE</div>
        <div class="p-bar-bg"><div class="p-bar-fill" id="p-fill"></div></div>
    </div>

    <div class="grade-nav">
        <button class="grade-tab active" onclick="setGrade(1, this)">LEVEL 1</button>
        <button class="grade-tab" onclick="setGrade(2, this)">LEVEL 2</button>
        <button class="grade-tab" onclick="setGrade(3, this)">LEVEL 3</button>
    </div>

    <div class="world-grid">
        <div class="island" onclick="launch('Math')"><span class="island-icon">üî¢</span><b>Math</b></div>
        <div class="island" onclick="launch('Reading')"><span class="island-icon">üìñ</span><b>Reading</b></div>
        <div class="island" onclick="launch('Science')"><span class="island-icon">üß™</span><b>Science</b></div>
        <div class="island" onclick="openLibrary()"><span class="island-icon">üìú</span><b>Library</b></div>
        <div class="island" onclick="openShop()"><span class="island-icon">üõçÔ∏è</span><b>Closet</b></div>
        <div class="island" onclick="toggleNight()"><span class="island-icon">üåô</span><b>Night</b></div>
    </div>

    <div id="quest-modal" class="modal">
        <h2 id="q-head">CHALLENGE</h2>
        <div id="q-text" style="font-size: 2rem; font-weight: 900; margin: 30px 0;">?</div>
        <div id="opt-grid"></div>
        <button class="exit-btn" onclick="closeAll()">EXIT</button>
    </div>

    <div id="lib-modal" class="modal">
        <h1 id="lib-title">Story</h1>
        <div id="story-content" style="font-size: 1.3rem; line-height: 1.6; margin: 20px 0;"></div>
        <button class="opt-btn" style="background:var(--p-gold); border:none;" onclick="readStory()">üîä READ ALOUD</button>
        <button class="exit-btn" onclick="window.speechSynthesis.cancel(); closeAll()">CLOSE</button>
    </div>

    <div id="report-modal" class="modal">
        <h1>PARENT REPORT</h1>
        <div style="font-size: 1.2rem; margin: 20px 0;">
            <b>Student:</b> <span id="r-name">---</span><br>
            <b>Lessons Completed:</b> <span id="r-score">0</span>
        </div>
        <button class="opt-btn" style="background:var(--p-green); color:white;" onclick="addStars(10000)">+10,000 STARS (ADMIN)</button>
        <button class="exit-btn" onclick="closeAll()">CLOSE</button>
    </div>

    <div id="shop-modal" class="modal">
        <h1>CLOSET</h1>
        <div class="world-grid">
            <div class="island" onclick="buy('üëë', 200)">üëë<br>200</div>
            <div class="island" onclick="buy('üï∂Ô∏è', 200)">üï∂Ô∏è<br>200</div>
            <div class="island" onclick="buy('üßô', 500)">üßô<br>500</div>
        </div>
        <button class="exit-btn" onclick="closeAll()">BACK</button>
    </div>

    <script>
        let stars = 250; let grade = 1; let lessonsDone = 0; let userName = "Hero";
        let synth = window.speechSynthesis;

        const content = {
            Math: {
                1: [{q:"1+1?", a:"2", o:["1","2","3"]}, {q:"5-2?", a:"3", o:["2","3","4"]}],
                2: [{q:"5x5?", a:"25", o:["20","25","30"]}, {q:"10x2?", a:"20", o:["20","25"]}],
                3: [{q:"100/4?", a:"25", o:["20","25","30"]}, {q:"12x12?", a:"144", o:["144","164"]}]
            },
            Reading: {
                1: [{q:"A is for...", a:"Apple", o:["Apple","Cat"]}],
                2: [{q:"Opposite of Hot?", a:"Cold", o:["Cold","Fire"]}],
                3: [{q:"Identify Noun", a:"Ball", o:["Run","Ball"]}],
            },
            Science: {
                1: [{q:"Is the Sun hot?", a:"Yes", o:["Yes","No"]}],
                2: [{q:"Ice is...", a:"Solid", o:["Solid","Gas"]}],
                3: [{q:"Do plants need water?", a:"Yes", o:["Yes","No"]}]
            }
        };

        function startGame() {
            let name = document.getElementById('user-name-input').value;
            if(name.trim() !== "") {
                userName = name;
                document.getElementById('welcome-msg').innerText = "HELLO, " + userName.toUpperCase() + "!";
                document.getElementById('login-screen').style.display = 'none';
                dragonTalk("Welcome to your adventure!");
            } else { alert("Please enter a name!"); }
        }

        function dragonTalk(customText) { 
            let t = customText || "You are doing great, " + userName;
            synth.speak(new SpeechSynthesisUtterance(t)); 
        }
        
        function setGrade(n, el) { 
            grade = n; 
            document.querySelectorAll('.grade-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            dragonTalk("Switching to Level " + n);
        }

        function launch(s) {
            let bank = content[s][grade];
            let idx = 0;
            openModal('quest-modal');
            function show() {
                if(idx >= bank.length) { addStars(500); lessonsDone++; closeAll(); alert("Great job " + userName + "!"); return; }
                document.getElementById('q-text').innerText = bank[idx].q;
                let grid = document.getElementById('opt-grid'); grid.innerHTML = "";
                bank[idx].o.forEach(opt => {
                    let b = document.createElement('button'); b.className = "opt-btn"; b.innerText = opt;
                    b.onclick = () => { if(opt === bank[idx].a) { idx++; show(); } };
                    grid.appendChild(b);
                });
            }
            show();
        }

        function openLibrary() {
            document.getElementById('lib-title').innerText = "The Story of " + userName;
            document.getElementById('story-content').innerText = userName + " is a brave explorer who solved many puzzles and helped the Dragon grow into a King.";
            openModal('lib-modal');
        }
        function readStory() { synth.speak(new SpeechSynthesisUtterance(document.getElementById('story-content').innerText)); }
        
        function updateUI() {
            document.getElementById('s-val').innerText = stars;
            document.getElementById('p-fill').style.width = Math.min((stars/5000)*100, 100) + "%";
            let img = document.getElementById('p-img');
            let label = document.getElementById('p-name');
            if(stars < 1000) { img.innerText = "ü•ö"; label.innerText = "EGG STAGE"; }
            else if(stars < 3000) { img.innerText = "üê£"; label.innerText = "JUNIOR DRAGON"; }
            else { img.innerText = "üê≤"; label.innerText = "MASTER DRAGON"; }
        }

        function addStars(n) { stars += n; updateUI(); }
        function buy(i, p) { if(stars >= p) { stars -= p; document.getElementById('acc-box').innerText = i; updateUI(); closeAll(); } }
        function openReport() { document.getElementById('r-name').innerText = userName; document.getElementById('r-score').innerText = lessonsDone; openModal('report-modal'); }
        function toggleNight() { document.getElementById('master-body').classList.toggle('night-mode'); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeAll() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
        
        updateUI();
    </script>
</body>
</html>
