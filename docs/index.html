<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sovereign Quest: Omega</title>
    <style>
        :root { --gold: #ffa801; --green: #05c46b; --red: #ff3f34; --blue: #0984e3; --purple: #a29bfe; --dark: #1e272e; }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; margin: 0; padding: 10px; min-height: 100vh;
            background: #000 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
            background-size: cover; color: white; display: flex; flex-direction: column; align-items: center; overflow-x: hidden;
        }
        header, .panel, .card, .map-node, .inventory-slot { 
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6); 
        }
        header { width: 95%; max-width: 500px; padding: 15px; margin-bottom: 10px; text-align: center; }
        .panel { width: 95%; max-width: 500px; padding: 20px; text-align: center; box-sizing: border-box; }
        .btn { background: var(--green); color: white; border: none; padding: 12px 20px; border-radius: 50px; cursor: pointer; font-weight: bold; margin: 5px; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .hidden { display: none !important; }

        /* WORLD MAP */
        #world-map { 
            position: relative; width: 100%; height: 300px; 
            background: url('https://images.unsplash.com/photo-1506318137071-a8e063b49c01?auto=format&fit=crop&w=800&q=60') center;
            background-size: cover; border-radius: 20px; border: 2px solid var(--gold); margin-top: 10px;
        }
        .map-node { position: absolute; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; }
        .node-label { position: absolute; bottom: -18px; font-size: 0.6rem; background: black; padding: 2px 5px; border-radius: 5px; white-space: nowrap; }

        /* PET & BARS */
        .pet-area { margin: 10px 0; padding: 10px; background: rgba(0,0,0,0.4); border-radius: 15px; }
        .pet-icon { font-size: 3rem; animation: bounce 2s infinite; display: block; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .bar-bg { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 5px 0; }
        #hunger-bar { height: 100%; background: var(--green); border-radius: 10px; transition: width 0.5s; width: 100%; }

        /* CHAT BOX */
        #chat-box { background: rgba(0,0,0,0.5); height: 150px; overflow-y: auto; margin: 10px 0; padding: 10px; text-align: left; border-radius: 10px; font-size: 0.8rem; }
        .msg { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.1); }

        /* GRID SYSTEM */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .card { padding: 15px 5px; cursor: pointer; font-size: 0.8rem; font-weight: bold; height: 80px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>
    <div id="bg-stars"></div>

    <section id="setup-view" class="panel">
        <h1 style="color:var(--gold); margin:0;">SOVEREIGN</h1>
        <div id="player-list" style="margin: 20px 0;"></div>
        <button class="btn" onclick="playSound('click'); addPlayer();">CREATE HERO</button>
        <button class="btn" style="background:var(--blue)" onclick="showLeaderboard()">RANKINGS</button>
        <button class="btn" style="background:var(--dark); font-size:0.6rem;" onclick="toggleAdmin()">ADMIN KEY</button>
    </section>

    <main id="game-ui" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center;">
        <header>
            <div style="display:flex; justify-content: space-between; align-items:center;">
                <span id="header-avatar" style="font-size:1.5rem;">üë§</span>
                <span id="user-display" style="font-weight:bold;">Hero</span>
                <span style="color:var(--gold)">‚≠ê <span id="star-count">0</span></span>
            </div>
            
            <div class="pet-area">
                <span id="active-pet" class="pet-icon">ü•ö</span>
                <div style="font-size:0.7rem;">LVL <span id="pet-lvl">1</span> <span id="pet-name">Egg</span></div>
                <div class="bar-bg"><div id="hunger-bar"></div></div>
                <button class="btn" style="padding:4px 10px; font-size:0.6rem; background:var(--blue);" onclick="feedPet()">üçï FEED (10 ‚≠ê)</button>
                <button class="btn" style="padding:4px 10px; font-size:0.6rem; background:var(--purple);" onclick="playPet()">üéæ PLAY</button>
            </div>

            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:5px;">
                <button class="btn" style="background:var(--gold); color:black; font-size:0.6rem; padding:5px 10px;" onclick="showView('shop')">SHOP</button>
                <button class="btn" style="background:var(--purple); font-size:0.6rem; padding:5px 10px;" onclick="showView('chat')">CHAT</button>
                <button class="btn" style="background:var(--green); font-size:0.6rem; padding:5px 10px;" onclick="showView('achievements')">TROPHIES</button>
                <button class="btn" style="background:var(--blue); font-size:0.6rem; padding:5px 10px;" onclick="showView('inventory')">BAG</button>
            </div>
        </header>

        <section id="menu-view" class="panel">
            <h4 style="margin:0;">WORLD MAP</h4>
            <div id="world-map">
                <div class="map-node" style="top:15%; left:15%;" onclick="startTrivia('space')">üåå<span class="node-label">SPACE</span></div>
                <div class="map-node" style="top:65%; left:20%;" onclick="startTrivia('history')">üìú<span class="node-label">HISTORY</span></div>
                <div class="map-node" style="top:40%; left:45%;" onclick="startTrivia('math')">üìê<span class="node-label">MATH</span></div>
                <div class="map-node" style="top:20%; left:75%;" onclick="startTrivia('coding')">üíª<span class="node-label">CODING</span></div>
                <div class="map-node" style="top:70%; left:70%;" onclick="startTrivia('animals')">ü¶Å<span class="node-label">WILDLIFE</span></div>
            </div>
            <button class="btn" style="width:100%; margin-top:15px; background:var(--red);" onclick="showView('minigames')">üé≤ PLAY MINIGAMES</button>
        </section>

        <section id="chat-view" class="hidden panel">
            <button class="btn" onclick="showView('menu')">‚¨Ö BACK</button>
            <div id="chat-box"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="chat-input" style="flex:1; padding:10px; border-radius:20px; border:none;" placeholder="Message...">
                <button class="btn" style="margin:0;" onclick="sendMsg()">SEND</button>
            </div>
        </section>

        <section id="shop-view" class="hidden panel">
            <button class="btn" onclick="showView('menu')">‚¨Ö BACK</button>
            <h3 style="color:var(--gold); margin:10px 0;">PETS & AVATARS</h3>
            <div class="grid">
                <div class="card" onclick="buyItem('üêâ', 'Dragon', 100, 'pet')">üêâ DRAGON (100)</div>
                <div class="card" onclick="buyItem('üê±', 'CyberCat', 75, 'pet')">üê± CAT (75)</div>
                <div class="card" onclick="buyItem('ü§ñ', 'Robot', 40, 'avatar')">ü§ñ ROBOT (40)</div>
                <div class="card" onclick="buyItem('üë®‚ÄçüöÄ', 'Hero', 40, 'avatar')">üë®‚ÄçüöÄ HERO (40)</div>
            </div>
            <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px;">
                <h4 style="margin:0;">üëë GO PRO</h4>
                <a href="https://buy.stripe.com/aFa8wIaPwbdF54cc4kcZa00" target="_blank" class="btn" style="font-size:0.7rem;">STRIPE</a>
            </div>
        </section>

        <section id="achievements-view" class="hidden panel">
            <button class="btn" onclick="showView('menu')">‚¨Ö BACK</button>
            <h3 style="color:var(--gold)">TROPHIES</h3>
            <div id="trophy-list" class="grid"></div>
        </section>

        <section id="inventory-view" class="hidden panel">
            <button class="btn" onclick="showView('menu')">‚¨Ö BACK</button>
            <h3 style="color:var(--gold)">YOUR BAG</h3>
            <div id="inv-list" class="grid"></div>
        </section>

        <section id="minigames-view" class="hidden panel">
            <button class="btn" onclick="showView('menu')">‚¨Ö BACK</button>
            <div class="card" style="width:100%; height:auto; margin:10px 0;" onclick="playGame()">ü§î GUESS THE NUMBER</div>
            <p style="font-size:0.7rem;">Win stars by guessing right!</p>
        </section>

        <section id="leaderboard-view" class="hidden panel">
            <button class="btn" onclick="showView('setup')">‚¨Ö BACK</button>
            <h3 style="color:var(--gold)">WORLD RANKINGS</h3>
            <div id="rank-list" style="text-align:left;"></div>
        </section>
    </main>

    <script>
        let players = JSON.parse(localStorage.getItem('SQ_Omega_Data')) || [];
        let messages = JSON.parse(localStorage.getItem('SQ_Omega_Msgs')) || [{user: "System", text: "Welcome to Sovereign!"}];
        let cur = null;
        let isAdmin = false;

        // --- AUDIO ENGINE ---
        function playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const g = ctx.createGain();
            osc.connect(g); g.connect(ctx.destination);
            if(type === 'click') { osc.frequency.setValueAtTime(400, ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1); osc.start(); osc.stop(ctx.currentTime + 0.1); }
            if(type === 'win') { osc.frequency.setValueAtTime(600, ctx.currentTime); osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.2); g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3); osc.start(); osc.stop(ctx.currentTime + 0.3); }
        }

        // --- ADMIN ---
        function toggleAdmin() { if(prompt("Pass:") === "1234") { isAdmin = true; alert("Admin Active."); } }

        // --- CORE LOGIC ---
        function addPlayer() {
            let n = prompt("Hero Name:");
            if(n) { players.push({name:n, stars:50, petIcon:null, petName:"Egg", petLvl:1, hunger:100, avatar:'üë§', bag:[], trophies:[]}); save(); renderList(); }
        }

        function renderList() {
            const l = document.getElementById('player-list'); l.innerHTML = "";
            players.forEach((p, i) => {
                let d = document.createElement('div'); d.className="card"; d.style.height="40px"; d.style.margin="8px 0";
                d.innerHTML = `${p.avatar} ${p.name} ‚Ä¢ ‚≠ê ${p.stars}`;
                d.onclick = () => { playSound('click'); login(i); }; l.appendChild(d);
            });
        }

        function login(i) {
            cur = i; showView('game-ui');
            updateUI();
            setInterval(() => { if(players[cur].petIcon) { players[cur].hunger = Math.max(0, players[cur].hunger - 1); updateUI(); } }, 5000);
        }

        function startTrivia(type) {
            playSound('click');
            let q = { "math": ["12 + 8", "20"], "space": ["Red Planet?", "mars"], "coding": ["JS full name?", "javascript"], "animals": ["King of Jungle?", "lion"], "history": ["Built pyramids?", "egyptians"] };
            let ans = prompt(`MISSION: ${type.toUpperCase()}\nQuestion: ${q[type][0]}`);
            if(ans && ans.toLowerCase().includes(q[type][1])) {
                playSound('win'); players[cur].stars += 25; 
                if(!players[cur].trophies.includes(type)) players[cur].trophies.push(type);
                save(); updateUI(); alert("SUCCESS! +25 Stars");
            }
        }

        function buyItem(icon, name, cost, type) {
            if(players[cur].stars >= cost) {
                players[cur].stars -= cost;
                if(type === 'pet') { players[cur].petIcon = icon; players[cur].petName = name; players[cur].petLvl = 1; }
                else { players[cur].avatar = icon; }
                players[cur].bag.push(icon);
                save(); updateUI(); playSound('win');
            } else { alert("Not enough stars!"); }
        }

        function feedPet() {
            if(players[cur].stars >= 10) {
                players[cur].stars -= 10;
                players[cur].hunger = Math.min(100, players[cur].hunger + 25);
                players[cur].petLvl++;
                if(players[cur].petLvl === 10) { players[cur].petIcon = "üê≤"; alert("EVOLUTION! Elder Dragon!"); }
                save(); updateUI(); playSound('win');
            }
        }

        function playPet() { players[cur].hunger = Math.min(100, players[cur].hunger + 5); save(); updateUI(); }

        function sendMsg() {
            let inp = document.getElementById('chat-input');
            if(inp.value) {
                messages.push({id: Date.now(), user: players[cur].name, text: inp.value});
                if(messages.length > 20) messages.shift();
                localStorage.setItem('SQ_Omega_Msgs', JSON.stringify(messages));
                inp.value = ""; renderChat();
            }
        }

        function renderChat() {
            document.getElementById('chat-box').innerHTML = messages.map(m => `
                <div class="msg">
                    <b>${m.user}:</b> ${m.text}
                    ${isAdmin ? `<span style="color:red; float:right;" onclick="delMsg(${m.id})">‚úñ</span>` : ''}
                </div>`).join("");
        }
        function delMsg(id) { messages = messages.filter(m => m.id !== id); localStorage.setItem('SQ_Omega_Msgs', JSON.stringify(messages)); renderChat(); }

        function playGame() {
            let n = Math.floor(Math.random() * 5) + 1;
            let g = prompt("Guess 1-5:");
            if(parseInt(g) === n) { players[cur].stars += 20; save(); updateUI(); playSound('win'); alert("YOU GOT IT!"); }
        }

        function updateUI() {
            let p = players[cur];
            document.getElementById('star-count').innerText = p.stars;
            document.getElementById('header-avatar').innerText = p.avatar;
            document.getElementById('active-pet').innerText = p.petIcon || "ü•ö";
            document.getElementById('pet-lvl').innerText = p.petLvl;
            document.getElementById('pet-name').innerText = p.petName;
            document.getElementById('hunger-bar').style.width = p.hunger + "%";
            document.getElementById('inv-list').innerHTML = p.bag.map(i => `<div class="card">${i}</div>`).join("");
            document.getElementById('trophy-list').innerHTML = p.trophies.map(t => `<div class="card">üèÜ ${t.toUpperCase()}</div>`).join("");
        }

        function showLeaderboard() {
            let s = [...players].sort((a,b) => b.stars - a.stars);
            document.getElementById('rank-list').innerHTML = s.map((p,i) => `<div>#${i+1} ${p.avatar} ${p.name} - ‚≠ê ${p.stars}</div>`).join("");
            showView('leaderboard');
        }

        function showView(v) {
            document.querySelectorAll('section, main').forEach(s => s.classList.add('hidden'));
            if(v === 'setup') document.getElementById('setup-view').classList.remove('hidden');
            else { document.getElementById('game-ui').classList.remove('hidden'); document.getElementById(v + '-view').classList.remove('hidden'); }
            if(v === 'chat') renderChat();
        }

        function save() { localStorage.setItem('SQ_Omega_Data', JSON.stringify(players)); }
        renderList();
    </script>
</body>
</html>
