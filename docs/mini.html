<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Games | Kid Learn Quest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  color:#fff;
}

.header{
  padding:16px;
  text-align:center;
}

.levels, .games{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
  gap:14px;
  padding:20px;
}

.card{
  background:#fff;
  color:#333;
  border-radius:20px;
  padding:16px;
  text-align:center;
  cursor:pointer;
  transition:.2s;
}
.card:hover{transform:scale(1.05)}
.card span{font-size:40px;display:block}

.locked{
  opacity:.5;
  pointer-events:none;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-content{
  background:#fff;
  color:#333;
  border-radius:20px;
  padding:20px;
  width:90%;
  max-width:420px;
  text-align:center;
}

button{
  margin-top:12px;
  padding:10px 18px;
  border:none;
  border-radius:14px;
  background:#4f46e5;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.color{
  width:60px;height:60px;
  border-radius:50%;
  display:inline-block;
  margin:10px;
}
</style>
</head>

<body>

<div class="header">
  <h1>üéÆ Mini Games</h1>
  <p id="kidInfo"></p>
  <p>‚≠ê Stars: <b id="stars">0</b> | Level: <b id="level">1</b></p>
</div>

<div class="levels" id="levels"></div>
<div class="games" id="games" style="display:none"></div>

<button style="width:90%;margin:20px" onclick="goHome()">‚¨Ö Back Home</button>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
/* ===== ACTIVE KID ===== */
const kids = JSON.parse(localStorage.getItem("klq_kids")||"[]");
const active = localStorage.getItem("klq_active_kid");
const kid = kids[active];

if(!kid){
  alert("No child selected");
  location.href="index.html";
}

kid.level = kid.level || 1;
kid.stars = kid.stars || 0;

document.getElementById("kidInfo").innerText =
  `${kid.avatar} ${kid.name} ‚Ä¢ Age ${kid.age}`;
document.getElementById("stars").innerText = kid.stars;
document.getElementById("level").innerText = kid.level;

/* ===== LEVEL SELECT ===== */
const levelsDiv=document.getElementById("levels");
for(let i=1;i<=5;i++){
  const d=document.createElement("div");
  d.className="card"+(i>kid.level?" locked":"");
  d.innerHTML=`<span>‚≠ê</span>Level ${i}`;
  d.onclick=()=>openGames(i);
  levelsDiv.appendChild(d);
}

/* ===== OPEN GAMES ===== */
function openGames(level){
  levelsDiv.style.display="none";
  games.style.display="grid";
  games.innerHTML=`
    <div class="card" onclick="shapeGame(${level})"><span>üî∫</span>Shapes</div>
    <div class="card" onclick="colorGame(${level})"><span>üé®</span>Colors</div>
    <div class="card" onclick="memoryGame(${level})"><span>üß†</span>Memory</div>
  `;
}

/* ===== MODAL ===== */
function show(html){
  modalContent.innerHTML=html;
  modal.style.display="flex";
}
function closeModal(){modal.style.display="none"}

/* ===== REWARD ===== */
function reward(stars){
  kid.stars+=stars;
  if(kid.stars>=kid.level*5 && kid.level<5){
    kid.level++;
    alert("üéâ Level Up!");
  }
  localStorage.setItem("klq_kids",JSON.stringify(kids));
  location.reload();
}

/* ===== SHAPES ===== */
function shapeGame(level){
  const shapes=["‚¨õ","üî∫","‚ö™","‚≠ê"];
  const max=level+1;
  const set=shapes.slice(0,max);
  const answer=set[Math.floor(Math.random()*set.length)];
  show(`
    <h2>üî∫ Shape Match</h2>
    <h1>${answer}</h1>
    ${set.map(s=>`<button onclick="pick('${s}','${answer}')">${s}</button>`).join("")}
    <button onclick="closeModal()">Exit</button>
  `);
}

/* ===== COLORS ===== */
function colorGame(level){
  const colors=["red","blue","yellow","green"];
  const set=colors.slice(0,level+1);
  const answer=set[Math.floor(Math.random()*set.length)];
  show(`
    <h2>üé® Tap ${answer.toUpperCase()}</h2>
    ${set.map(c=>`<div class="color" style="background:${c}" onclick="pick('${c}','${answer}')"></div>`).join("")}
    <br><button onclick="closeModal()">Exit</button>
  `);
}

/* ===== MEMORY ===== */
function memoryGame(level){
  let icons=["üê∂","üê±","üê∏","ü¶ä"].slice(0,level+1);
  let cards=[...icons,...icons].sort(()=>Math.random()-0.5);
  let first=null,lock=false;
  show(`<h2>üß† Memory</h2><div id="board"></div><button onclick="closeModal()">Exit</button>`);
  const board=document.getElementById("board");

  cards.forEach(c=>{
    const b=document.createElement("button");
    b.innerText="‚ùì";
    b.style.margin="6px";
    b.onclick=()=>{
      if(lock||b.innerText!=="‚ùì")return;
      b.innerText=c;
      if(!first){first=b;}
      else{
        lock=true;
        setTimeout(()=>{
          if(first.innerText===b.innerText){
            reward(2);
          }else{
            first.innerText="‚ùì";b.innerText="‚ùì";
          }
          first=null;lock=false;
        },600);
      }
    };
    board.appendChild(b);
  });
}

/* ===== PICK ===== */
function pick(pick,correct){
  if(pick===correct){
    reward(2);
    alert("‚≠ê Correct!");
  }else alert("‚ùå Try again");
}

function goHome(){location.href="index.html";}
</script>

</body>
</html>
