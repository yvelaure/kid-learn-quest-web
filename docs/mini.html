<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Games â€“ Kid Learn Quest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  margin:0;
  font-family:Arial;
  background:#eef2ff;
  text-align:center;
}
h2{margin:10px}
.menu{
  display:flex;
  justify-content:center;
  gap:8px;
  flex-wrap:wrap;
}
.menu button{
  padding:10px 12px;
  border:none;
  border-radius:14px;
  background:#6a5acd;
  color:#fff;
  font-size:13px;
}
.top{
  display:flex;
  justify-content:space-around;
  font-size:16px;
  margin:8px 0;
}
canvas{
  background:#fff;
  border-radius:20px;
  box-shadow:0 8px 20px rgba(0,0,0,.2);
}
</style>
</head>
<body>

<h2>ğŸ® Mini Games</h2>

<div class="menu">
  <button onclick="startCounting()">ğŸ”¢ Count</button>
  <button onclick="startLetters()">ğŸ”¤ Letters</button>
  <button onclick="startMemory()">ğŸ§  Memory</button>
  <button onclick="startShapes()">ğŸ”º Shapes</button>
  <button onclick="startColors()">ğŸ¨ Colors</button>
</div>

<div class="top">
  <div>â­ <span id="stars">0</span></div>
  <div>ğŸ† Level <span id="level">1</span></div>
</div>

<canvas id="game" width="320" height="420"></canvas>

<script>
/* ===== PROFILE ===== */
let kids = JSON.parse(localStorage.getItem("klq_kids")||"[]");
let idx = localStorage.getItem("klq_active_kid")||0;
let kid = kids[idx] || {age:4,stars:0,level:1};
kid.stars ||= 0; kid.level ||= 1;
stars.textContent = kid.stars;
level.textContent = kid.level;

function save(){
  kids[idx]=kid;
  localStorage.setItem("klq_kids",JSON.stringify(kids));
}

/* ===== CANVAS ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

/* ===== GLOBAL ===== */
let mode="";
let objects=[], cards=[], selected=[];
let shapes=[], targets=[];
let colors=[], targetColor="";
let score=0;

/* ===== RESET ===== */
function reset(){
  ctx.clearRect(0,0,320,420);
  objects=[]; cards=[]; selected=[];
  shapes=[]; targets=[]; colors=[];
  score=0;
}

/* ===== DIFFICULTY ===== */
let speed = kid.age<5?1:kid.age<7?1.6:2.3;

/* ===== COUNTING ===== */
function startCounting(){
  reset(); mode="count";
}
function spawnStar(){
  objects.push({x:Math.random()*260+30,y:-20,r:16});
}
setInterval(()=>{ if(mode==="count") spawnStar(); },1200);

function drawCount(){
  ctx.clearRect(0,0,320,420);
  objects.forEach(o=>{
    o.y+=speed;
    ctx.beginPath();
    ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
    ctx.fillStyle="gold";
    ctx.fill();
  });
  objects=objects.filter(o=>o.y<450);
}

/* ===== LETTERS ===== */
function startLetters(){
  reset(); mode="letter";
  objects=[String.fromCharCode(65+Math.random()*26|0)];
}
function drawLetters(){
  ctx.clearRect(0,0,320,420);
  ctx.font="90px Arial";
  ctx.fillStyle="#6a5acd";
  ctx.textAlign="center";
  ctx.fillText(objects[0],160,260);
}

/* ===== MEMORY ===== */
function startMemory(){
  reset(); mode="memory";
  let s=["ğŸ¶","ğŸ±","ğŸ¶","ğŸ±","ğŸ¸","ğŸ¸"];
  s.sort(()=>Math.random()-0.5);
  s.forEach((v,i)=>cards.push({
    v,x:(i%3)*100+40,y:Math.floor(i/3)*120+90,
    open:false,done:false
  }));
}
function drawMemory(){
  ctx.clearRect(0,0,320,420);
  cards.forEach(c=>{
    ctx.fillStyle=c.open||c.done?"#fff":"#6a5acd";
    ctx.fillRect(c.x-40,c.y-40,80,80);
    if(c.open||c.done){
      ctx.font="40px Arial";
      ctx.fillStyle="#000";
      ctx.textAlign="center";
      ctx.fillText(c.v,c.x,c.y+14);
    }
  });
}

/* ===== SHAPES ===== */
function startShapes(){
  reset(); mode="shapes";
  shapes=[
    {type:"circle",x:80,y:100},
    {type:"square",x:160,y:100},
    {type:"triangle",x:240,y:100}
  ];
  targets=[
    {type:"circle",x:80,y:300},
    {type:"square",x:160,y:300},
    {type:"triangle",x:240,y:300}
  ];
}
function drawShapes(){
  ctx.clearRect(0,0,320,420);
  targets.forEach(t=>drawShape(t.type,t.x,t.y,"#ddd"));
  shapes.forEach(s=>drawShape(s.type,s.x,s.y,"#6a5acd"));
}
function drawShape(type,x,y,color){
  ctx.fillStyle=color;
  if(type==="circle"){ ctx.beginPath(); ctx.arc(x,y,22,0,Math.PI*2); ctx.fill(); }
  if(type==="square"){ ctx.fillRect(x-22,y-22,44,44); }
  if(type==="triangle"){
    ctx.beginPath();
    ctx.moveTo(x,y-24); ctx.lineTo(x-24,y+24); ctx.lineTo(x+24,y+24);
    ctx.closePath(); ctx.fill();
  }
}

/* ===== COLORS ===== */
function startColors(){
  reset(); mode="colors";
  colors=["red","blue","green","yellow"];
  targetColor=colors[Math.random()*colors.length|0];
}
function drawColors(){
  ctx.clearRect(0,0,320,420);
  ctx.font="24px Arial";
  ctx.fillStyle="#000";
  ctx.textAlign="center";
  ctx.fillText("Tap the color:",160,60);
  ctx.fillStyle=targetColor;
  ctx.fillText(targetColor.toUpperCase(),160,90);
  colors.forEach((c,i)=>{
    ctx.fillStyle=c;
    ctx.fillRect(40+i*70,180,50,50);
  });
}

/* ===== INPUT ===== */
let drag=null;
canvas.addEventListener("mousedown",e=>{
  let x=e.offsetX,y=e.offsetY;
  if(mode==="shapes"){
    shapes.forEach(s=>{
      if(Math.hypot(x-s.x,y-s.y)<30) drag=s;
    });
  }
});
canvas.addEventListener("mousemove",e=>{
  if(drag){ drag.x=e.offsetX; drag.y=e.offsetY; }
});
canvas.addEventListener("mouseup",()=>{
  if(drag){
    targets.forEach(t=>{
      if(t.type===drag.type && Math.hypot(drag.x-t.x,drag.y-t.y)<30){
        kid.stars++; kid.level++;
        stars.textContent=kid.stars;
        level.textContent=kid.level;
        save();
        startShapes();
      }
    });
    drag=null;
  }
});
canvas.addEventListener("click",e=>{
  let x=e.offsetX,y=e.offsetY;
  if(mode==="count"){
    objects.forEach((o,i)=>{
      if(Math.hypot(x-o.x,y-o.y)<o.r){
        objects.splice(i,1);
        score++;
        if(score>=5){ kid.stars++; kid.level++; save(); score=0; }
      }
    });
  }
  if(mode==="letter"){ kid.stars++; kid.level++; save(); startLetters(); }
  if(mode==="memory"){
    cards.forEach(c=>{
      if(!c.open&&!c.done && x>c.x-40&&x<c.x+40&&y>c.y-40&&y<c.y+40){
        c.open=true; selected.push(c);
        if(selected.length===2){
          if(selected[0].v===selected[1].v){
            selected.forEach(s=>s.done=true);
            kid.stars++; save();
          }
          setTimeout(()=>{selected.forEach(s=>s.open=false); selected=[];},600);
        }
      }
    });
  }
  if(mode==="colors"){
    colors.forEach((c,i)=>{
      if(x>40+i*70&&x<90+i*70&&y>180&&y<230){
        if(c===targetColor){
          kid.stars++; kid.level++; save();
          startColors();
        }
      }
    });
  }
});

/* ===== LOOP ===== */
function loop(){
  if(mode==="count") drawCount();
  if(mode==="letter") drawLetters();
  if(mode==="memory") drawMemory();
  if(mode==="shapes") drawShapes();
  if(mode==="colors") drawColors();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
